<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Wallet NFC Writer</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; padding: 20px; }
        .card { background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); max-width: 500px; margin: auto; padding: 20px; }
        .card-title { font-size: 24px; text-align: center; margin-bottom: 20px; }
        .preview { 
            background: #f8f9fa; 
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            border: 1px solid #ddd;
        }
        .preview-title {
            font-size: 18px;
            color: #1a73e8;
            margin-bottom: 10px;
        }
        .preview-desc {
            color: #5f6368;
            margin-bottom: 15px;
        }
        .preview-button {
            background: #1a73e8;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            display: inline-block;
            font-size: 14px;
        }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 5px; color: #444; }
        .input-group input, .input-group textarea { 
            width: 100%; 
            padding: 8px; 
            border: 1px solid #ddd; 
            border-radius: 4px; 
            font-size: 16px; 
        }
        .input-group textarea { 
            resize: vertical; 
            min-height: 80px; 
        }
        button { 
            width: 100%; 
            padding: 12px; 
            border: none; 
            border-radius: 4px; 
            background: #1a73e8; 
            color: white; 
            cursor: pointer; 
            font-size: 16px; 
            transition: 0.2s; 
            margin-bottom: 10px; 
        }
        button:hover { background: #1557b0; }
        .message, .error { padding: 15px; border-radius: 4px; margin-bottom: 15px; }
        .message { background: #e6f4ea; color: #1e8e3e; }
        .error { background: #fce8e6; color: #d93025; }
        #status { margin-top: 20px; text-align: center; color: #5f6368; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="card">
        <h1 class="card-title">Google Wallet NFC Writer</h1>

        <div class="input-group">
            <label for="title">Title*</label>
            <input type="text" id="title" required 
                value="Gabriel Baude"
                oninput="updatePreview()">
        </div>
        <div class="input-group">
            <label for="desc">Description</label>
            <textarea id="desc" 
                oninput="updatePreview()">Innovation and design leader
Email: baude.gabriel@gmail.com</textarea>
        </div>
        <div class="input-group">
            <label for="url">Profile URL*</label>
            <input type="url" id="url" required 
                value="https://www.linkedin.com/in/gabrielbaude/"
                oninput="updatePreview()">
        </div>

        <div class="preview">
            <div class="preview-title" id="previewTitle">Gabriel Baude</div>
            <div class="preview-desc" id="previewDesc">Innovation and design leader
Email: baude.gabriel@gmail.com</div>
            <div class="preview-button">View Profile</div>
        </div>
        
        <button id="writeButton">Write to NFC Tag</button>
        
        <div id="message" class="message hidden"></div>
        <div id="error" class="error hidden"></div>
        <div id="status"></div>
    </div>

    <script>
        const writeButton = document.getElementById('writeButton');
        const messageDiv = document.getElementById('message');
        const errorDiv = document.getElementById('error');
        const statusDiv = document.getElementById('status');

        function updatePreview() {
            document.getElementById('previewTitle').textContent = 
                document.getElementById('title').value || 'Title Preview';
            document.getElementById('previewDesc').textContent = 
                document.getElementById('desc').value || 'Description Preview';
        }

        function showMessage(text) {
            messageDiv.textContent = text;
            messageDiv.classList.remove('hidden');
            errorDiv.classList.add('hidden');
        }

        function showError(text) {
            errorDiv.textContent = text;
            errorDiv.classList.remove('hidden');
            messageDiv.classList.add('hidden');
        }

        function updateStatus(text) {
            statusDiv.textContent = text;
        }

        async function writeNFCTag() {
            const title = document.getElementById('title').value;
            const desc = document.getElementById('desc').value;
            const url = document.getElementById('url').value;

            if (!title || !url) {
                showError('Please fill in all required fields');
                return;
            }

            try {
                const ndef = new NDEFReader();
                showMessage('Hold your device near an NFC tag to write...');
                updateStatus('Waiting for NFC tag...');

                // Create records optimized for Google Wallet
                await ndef.write({
                    records: [
                        {
                            recordType: "url",
                            data: url
                        },
                        {
                            recordType: "text",
                            data: title,
                            lang: "en"
                        },
                        {
                            recordType: "text",
                            data: desc,
                            lang: "en"
                        },
                        {
                            // Android Application Record for Google Wallet
                            recordType: "android.com:pkg",
                            data: "com.google.android.apps.walletnfcrel"
                        }
                    ]
                });

                showMessage('Successfully wrote to NFC tag!');
                updateStatus('Write completed');

            } catch (error) {
                showError(`Error writing to NFC: ${error.message}`);
                updateStatus('Write failed');
            }
        }

        writeButton.addEventListener('click', writeNFCTag);
        updatePreview(); // Initial preview update
    </script>
</body>
</html>